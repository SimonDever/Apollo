<div @fadeInOut class="view-wrapper">
	<div *ngIf="config"
			[class.icon-button-box-left]='!config.editMenuPositionRight'
			[class.icon-button-box]='config.editMenuPositionRight'>
		<button octicon="check" class="icon-button save-button" title="Done"
			(mousedown)="close($event)"></button>
		<button octicon="trashcan" class="icon-button trash-button" title="Delete"
			(mousedown)="showDeleteConfirmation($event, deleteModal)"></button>
		<button octicon="plus" class="icon-button search-metadata-provider-button" title="Add field"
			(mousedown)="showNewFieldDialog($event, newFieldDialog)"></button>
		<button octicon="search" class="icon-button search-metadata-provider-button" title="Search online for metadata"
			(mousedown)="showSearchDialog($event, searchDialog)"></button>
	</div>

	<div class="metadata-container">
		<input (change)="posterChange($event)" type="file" #posterInput />
		<div class="poster-preview" (mousedown)="posterInput.click()">
			<div *ngIf="!poster_path" class="poster-placeholder">Select Poster</div>
			<ng-container *ngIf="poster_path">
				<ng-container *ngIf="posterIsFile(poster_path)">
					<img [src]="posterUrl(poster_path)" id="poster-{{selectedEntryId}}" />
				</ng-container>
				<ng-container *ngIf="!posterIsFile(poster_path)">
					<img [src]="poster_path" id="poster-{{selectedEntryId}}" />
				</ng-container>
			</ng-container>
		</div>

		<form [formGroup]="entryForm">
			<div class="right-fields">
				<div class="field-grid three-column-reverse">
					<span class="metadata-field-key">
						Title
					</span>
					<span class="metadata-field-value">
						<div contenteditable="true" pasteText ngDefaultControl formControlName="title"
						[attr.data-key]="'title'" (blur)="saveFormIfDirty($event)" (input)="setDirty($event)"></div>
					</span>
				</div>

				<div class="field-grid three-column-reverse">
					<span class="metadata-field-key">Video File</span>
					<span class="metadata-field-value">{{file}}</span>
					<input (change)="fileChange($event)" type="file" #fileInput />
					<button class="btn btn-outline-light" (mousedown)="fileInput.click()">
						Browse
					</button>
				</div>

				<div > <!--dragula="inputs" [(dragulaModel)]="inputList"-->
					<ng-container *ngFor="let input of inputList">
						
						<ng-container *ngIf="input.label !== 'file' && input.label !== 'title'">
							<div class="field-grid three-column-reverse">
								<span class="metadata-field-key">
									{{ input.label.split('_').join(' ') | titlecase }}
								</span>
								<span class="metadata-field-value">
									<div contenteditable="true" pasteText ngDefaultControl formControlName="{{ input.formControlName }}"
									[attr.data-key]="input.label" (blur)="saveFormIfDirty($event)" (input)="setDirty($event)"></div>
								</span>
								<button class="btn btn-outline-light" (mousedown)="removeInputField($event, input)">Remove</button>
							</div>
						</ng-container>
					</ng-container>
				</div>
			</div>
		</form>

		<router-outlet></router-outlet>
	</div>

	<ng-template #searchDialog let-modal>
		<form [formGroup]="searchForm">
			<div class="modal-header">
				<h4 class="modal-title" id="modal-basic-title">Search Terms</h4>
				<button type="button" class="close" data-dismiss="modal" (click)="closeModal()" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body">
					<div class="form-group">
						<div class="input-group">
							<input ngbAutofocus formControlName="searchTerms" class="form-control" placeholder="title, genre, actor, etc." />
						</div>
					</div>
			</div>
			<div class="modal-footer">
				<button type="submit" class="btn btn-outline-light" (click)="search()">Search Online</button>
			</div>
		</form>
	</ng-template>

	<ng-template #newFieldDialog let-modal>
		<div class="modal-header">
			<h4 class="modal-title" id="modal-basic-title">Add new field</h4>
			<button type="button" class="close" data-dismiss="modal" (click)="closeModal()" aria-label="Close">
				<span aria-hidden="true">&times;</span>
			</button>
		</div>
		<div class="modal-body">
			<div class="form-group">
				<div class="input-group">
					<input ngbAutofocus #newField class="form-control" (keyup.enter)="addNewField(newField.value)" />
				</div>
			</div>
		</div>
		<div class="modal-footer">
			<button type="button" class="btn btn-outline-light" (click)="addNewField(newField.value)">Add new field</button>
		</div>
	</ng-template>

	<ng-template #deleteModal let-modal>
		<div class="modal-header">
			<h4 class="modal-title" id="modal-basic-title">Confirm deletion</h4>
			<button type="button" class="close" data-dismiss="modal" aria-label="Close"
				(click)="cancelDelete()" (keyup.enter)="cancelDelete()">
				<span aria-hidden="true">&times;</span>
			</button>
		</div>
		<div class="modal-body">
			<p><strong>Are you sure you want to delete this entry?</strong></p>
			<p><span class="text-danger">This operation can not be undone.</span></p>
		</div>
		<div class="modal-footer">
			<button type="button" ngbAutofocus class="btn btn-outline-light"
				(keyup.enter)="cancelDelete()" (click)="cancelDelete()">Cancel</button>
			<button type="button" class="btn btn-danger"
				(keyup.enter)="confirmDelete()" (click)="confirmDelete()">Ok</button>
		</div>
	</ng-template>
</div>
